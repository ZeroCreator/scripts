#!/bin/bash

#--------------------------------------------------------------------
# Script for timed restart of Cartman worker in crone
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ worker –ø—Ä–æ–µ–∫—Ç–∞ **CARTMAN**
# –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ crontab ->
# - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä worker –∏
# - –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∏ LOG_FILE
# Tested on Ubuntu 24.04.1 LTS
# Developed by Olga Shkola in 2025
#--------------------------------------------------------------------

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞:
# –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
# CONTAINER_NAME="<container_name>"
# –ü—É—Ç—å –¥–æ LOG_FILE
# LOG_FILE="/path/to/logs/"


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
log_with_timestamp() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_FILE"
}

# –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
if docker restart "$CONTAINER_NAME"; then
    message="‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä '$CONTAINER_NAME' —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.‚úàÔ∏è "
    log_with_timestamp "$message"
else
    message="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ '$CONTAINER_NAME'.ü§¨"
    log_with_timestamp "$message"
fi
